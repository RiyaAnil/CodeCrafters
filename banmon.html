<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bangalore Monuments and Museums Route</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="stylesheet" href="style.css"/>
    <style>
        #map { height: 100vh; }
        .route-container { padding: 20px; }
    </style>
</head>
<body onload="initializeBangaloreMonuments()">
    <div id="map"></div>
    <div id="route-details" class="route-container"></div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script>
        var map = L.map('map').setView([12.9716, 77.5946], 12); // Bangalore coordinates

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors'
        }).addTo(map);

        // Coordinates and descriptions for monuments and historical museums in Bangalore
        const monumentsAndMuseums = [
            { name: "Bangalore Palace", lat: 12.9981, lon: 77.5987, description: "A historic palace showcasing Tudor-style architecture and royal heritage." },
            { name: "Tipu Sultan's Summer Palace", lat: 12.9535, lon: 77.5757, description: "A beautiful palace built by Tipu Sultan, showcasing Indo-Islamic architecture." },
            { name: "Visvesvaraya Industrial and Technological Museum", lat: 12.9727, lon: 77.5946, description: "A museum dedicated to science and technology, with interactive exhibits." },
            { name: "National Gallery of Modern Art", lat: 12.9754, lon: 77.5944, description: "An art gallery showcasing contemporary Indian art." },
            { name: "Government Museum", lat: 12.9775, lon: 77.5910, description: "One of the oldest museums in India, featuring archeological, geological, and numismatic collections." }
        ];

        // Function to calculate the distance between two lat/lng points in meters using Haversine formula
        function getDistance(lat1, lon1, lat2, lon2) {
            var R = 6371; // Radius of the Earth in kilometers
            var dLat = (lat2 - lat1) * Math.PI / 180;
            var dLon = (lon2 - lon1) * Math.PI / 180;
            var a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                    Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                    Math.sin(dLon / 2) * Math.sin(dLon / 2);
            var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            var distance = R * c * 1000; // in meters
            return distance;
        }

        // Function to calculate the shortest path (greedy approach)
        function getShortestPath(userLocation, locations) {
            var path = [];
            var remainingLocations = [...locations];
            var currentLocation = userLocation;

            // Greedily select the nearest location and add to path
            while (remainingLocations.length > 0) {
                let closestLocation = null;
                let minDistance = Infinity;

                for (let i = 0; i < remainingLocations.length; i++) {
                    const distance = getDistance(currentLocation.lat, currentLocation.lon, remainingLocations[i].lat, remainingLocations[i].lon);
                    if (distance < minDistance) {
                        minDistance = distance;
                        closestLocation = remainingLocations[i];
                    }
                }

                // Add closest location to path and remove it from remaining locations
                path.push(closestLocation);
                currentLocation = closestLocation;
                remainingLocations = remainingLocations.filter(loc => loc !== closestLocation);
            }

            return path;
        }

        // Function to get user's current location
        function getUserLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    const userLocation = { lat: position.coords.latitude, lon: position.coords.longitude };
                    // Add a marker for the user's location
                    L.marker([userLocation.lat, userLocation.lon]).addTo(map).bindPopup("Your current location").openPopup();

                    // Get the shortest path from the user's location to all destinations
                    const shortestPath = getShortestPath(userLocation, monumentsAndMuseums);

                    // Add the path to the map
                    var latlngs = [userLocation, ...shortestPath.map(loc => [loc.lat, loc.lon])];
                    L.polyline(latlngs, { color: 'red' }).addTo(map);

                    // Adjust the map view to fit all the locations (user's location and destinations)
                    var bounds = L.latLngBounds(latlngs);
                    map.fitBounds(bounds);
                });
            } else {
                alert("Geolocation is not supported by this browser.");
            }
        }

        function initializeBangaloreMonuments() {
            // First, get user's location and calculate the shortest path
            getUserLocation();

            // Adding markers for each monument and museum
            monumentsAndMuseums.forEach(function(location) {
                var marker = L.marker([location.lat, location.lon]).addTo(map);
                marker.bindPopup(location.description);

                // You can add a mouseover effect to show popup on cursor hover
                marker.on('mouseover', function(e) {
                    this.openPopup();
                });
            });

            // Adding lines (optional) between the monuments and museums
            var latlngs = monumentsAndMuseums.map(function(location) {
                return [location.lat, location.lon];
            });
            var polyline = L.polyline(latlngs, { color: 'blue' }).addTo(map);
        }
    </script>
</body>
</html>
